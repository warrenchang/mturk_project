from otree.api import (
    models, widgets, BaseConstants, BaseSubsession, BaseGroup, BasePlayer,
    Currency as c, currency_range
)

import numpy as np

author = 'Your name here'

doc = """
Simply gamble choice for risk preference elicitation
"""


class Constants(BaseConstants):
    name_in_url = 'multiarm_bandit'
    players_per_group = None
    deltas = [4,4,4,4,4]

    interaction_length = [50,50,50]
    round_in_interactions = np.tile(np.arange(50)+1, reps=3)
    interactions = np.tile(np.arange(3) + 1, reps=(50, 1)).T.flatten()

    interaction_length = [10,10,10]
    round_in_interactions = np.tile(np.arange(10)+1, reps=3)
    interactions = np.tile(np.arange(3) + 1, reps=(10, 1)).T.flatten()


    mus1 = np.array([
       [31.2, 32.8, 40. , 55.2, 56.8],
       [32.3, 31.2, 37.4, 52.5, 53.4],
       [28.6, 27.5, 35.3, 50.3, 55.2],
       [32.5, 26.5, 36.4, 46.6, 54.1],
       [30.3, 25.1, 37.5, 46.2, 48.8],
       [32.1, 28.6, 39.6, 46.4, 46.5],
       [29.8, 30.1, 41.3, 44.1, 44. ],
       [35.2, 28. , 40.6, 43.5, 42.5],
       [30.6, 26.9, 40.1, 43.1, 40.3],
       [31.4, 28.8, 40.3, 47.3, 41. ],
       [34.4, 34.2, 39.4, 52.8, 39.7],
       [29.4, 36. , 34.8, 54.3, 42.8],
       [32.9, 37.4, 36.5, 51.2, 43.2],
       [32.4, 33.1, 38.6, 49.6, 44.9],
       [28.4, 34.8, 40.2, 48.9, 42.8],
       [31.5, 33.5, 37.1, 45.6, 46.3],
       [35.4, 36.2, 41.1, 47. , 50.1],
       [34.5, 35.7, 39.2, 46.2, 51.1],
       [32.1, 38.6, 42.5, 44.3, 52.3],
       [32.4, 40.9, 37.6, 41.4, 54. ],
       [32.3, 40.2, 39.8, 39.8, 51.8],
       [34.8, 40.7, 38.5, 39. , 54.5],
       [30.8, 40. , 39.2, 38.5, 59.1],
       [31. , 43.7, 41.5, 34.3, 60.2],
       [31.2, 43.5, 45.6, 32.8, 60.6],
       [32. , 47. , 46. , 33.4, 57.9],
       [27.5, 46.1, 46.5, 34.4, 59.5],
       [32.9, 45.1, 49. , 35.1, 61.8],
       [33.3, 43.8, 51.2, 34.1, 60.2],
       [35.3, 45.9, 52.8, 33.7, 60.9],
       [34.8, 42.5, 53.5, 35.8, 60.8],
       [34.9, 48.6, 54. , 34.2, 56.9],
       [34.3, 46.5, 56. , 35.9, 54.7],
       [36.9, 44.8, 50.9, 36.4, 53.1],
       [39. , 46.5, 52.6, 37.4, 51.8],
       [41.6, 48.2, 55. , 35.5, 49.4],
       [42. , 48.7, 51.3, 33.4, 51.7],
       [41.9, 47.5, 52.9, 33.9, 49.1],
       [41.2, 47.1, 53.7, 37.7, 45.5],
       [41.6, 48.4, 53.7, 40.7, 45.8],
       [40. , 48.2, 56.9, 36. , 45.7],
       [41.2, 46.9, 57.8, 33.2, 46.5],
       [42.9, 47.7, 57.4, 35.6, 48. ],
       [43.2, 49.5, 59.1, 38.1, 47.4],
       [43.8, 49.4, 57.5, 37.2, 48.6],
       [46.6, 51. , 58.6, 31.6, 52.6],
       [49.2, 47.1, 57.1, 31.8, 51.6],
       [50.8, 45.4, 56. , 31.7, 52. ],
       [50.6, 42. , 62.4, 26.8, 49.5],
       [53.7, 43.9, 59.4, 29.4, 49.2],
       [39. , 41. , 50. , 69. , 71. ],
       [40.4, 39.1, 46.7, 65.6, 66.8],
       [35.8, 34.4, 44.1, 62.8, 69. ],
       [40.6, 33.1, 45.6, 58.3, 67.7],
       [37.8, 31.4, 46.9, 57.8, 61. ],
       [40.1, 35.8, 49.5, 58. , 58.1],
       [37.3, 37.6, 51.7, 55.1, 55. ],
       [44. , 35. , 50.8, 54.4, 53.1],
       [38.3, 33.6, 50.1, 53.9, 50.4],
       [39.2, 36. , 50.4, 59.1, 51.2],
       [43. , 42.7, 49.2, 66. , 49.6],
       [36.7, 45. , 43.5, 67.9, 53.4],
       [41.2, 46.8, 45.7, 64. , 54. ],
       [40.5, 41.3, 48.2, 61.9, 56.2],
       [35.5, 43.4, 50.2, 61.1, 53.5],
       [39.4, 41.9, 46.4, 57. , 57.9],
       [44.2, 45.2, 51.3, 58.7, 62.7],
       [43.1, 44.7, 49. , 57.8, 63.8],
       [40.1, 48.3, 53.2, 55.4, 65.4],
       [40.5, 51.1, 46.9, 51.8, 67.5],
       [40.4, 50.3, 49.8, 49.8, 64.7],
       [43.5, 50.9, 48.1, 48.8, 68.1],
       [38.5, 50. , 49. , 48.1, 73.9],
       [38.8, 54.6, 51.9, 42.9, 75.2],
       [39. , 54.3, 57. , 41.1, 75.8],
       [40. , 58.7, 57.4, 41.7, 72.4],
       [34.4, 57.6, 58.1, 43.1, 74.4],
       [41.1, 56.3, 61.3, 43.9, 77.3],
       [41.6, 54.7, 64. , 42.6, 75.3],
       [44.2, 57.4, 65.9, 42.2, 76.1],
       [43.6, 53.1, 66.9, 44.8, 76. ],
       [43.6, 60.7, 67.5, 42.8, 71.1],
       [42.9, 58.1, 70. , 44.9, 68.3],
       [46.2, 56. , 63.6, 45.5, 66.4],
       [48.8, 58.1, 65.8, 46.7, 64.8],
       [52. , 60.3, 68.8, 44.4, 61.7],
       [52.5, 60.8, 64.2, 41.8, 64.6],
       [52.3, 59.3, 66.1, 42.4, 61.3],
       [51.5, 58.9, 67.1, 47.2, 56.9],
       [52.1, 60.5, 67.2, 50.8, 57.2],
       [50. , 60.3, 71.1, 45. , 57.1],
       [51.5, 58.6, 72.3, 41.5, 58.1],
       [53.6, 59.6, 71.7, 44.5, 60. ],
       [54. , 61.9, 73.9, 47.6, 59.3],
       [54.7, 61.8, 71.8, 46.5, 60.8],
       [58.2, 63.7, 73.2, 39.5, 65.8],
       [61.5, 58.9, 71.4, 39.7, 64.5],
       [63.6, 56.8, 70. , 39.6, 65. ],
       [63.3, 52.5, 78. , 33.5, 61.9],
       [67.2, 54.8, 74.2, 36.7, 61.5],
       [46.8, 49.2, 60. , 82.8, 85.2],
       [48.5, 46.9, 56. , 78.7, 80.1],
       [42.9, 41.2, 52.9, 75.4, 82.8],
       [48.7, 39.8, 54.7, 69.9, 81.2],
       [45.4, 37.7, 56.3, 69.3, 73.2],
       [48.2, 43. , 59.4, 69.6, 69.7],
       [44.7, 45.2, 62. , 66.1, 66. ],
       [52.7, 42. , 61. , 65.3, 63.7],
       [46. , 40.3, 60.2, 64.7, 60.5],
       [47.1, 43.2, 60.5, 70.9, 61.5],
       [51.6, 51.3, 59.1, 79.2, 59.5],
       [44. , 53.9, 52.2, 81.4, 64.1],
       [49.4, 56.1, 54.8, 76.8, 64.7],
       [48.6, 49.6, 57.8, 74.3, 67.4],
       [42.5, 52.1, 60.2, 73.3, 64.2],
       [47.3, 50.3, 55.7, 68.4, 69.4],
       [53.1, 54.3, 61.6, 70.4, 75.2],
       [51.7, 53.6, 58.8, 69.3, 76.6],
       [48.1, 57.9, 63.8, 66.5, 78.4],
       [48.7, 61.3, 56.3, 62.2, 80.9],
       [48.5, 60.3, 59.7, 59.7, 77.6],
       [52.2, 61.1, 57.7, 58.6, 81.7],
       [46.2, 60. , 58.8, 57.8, 88.7],
       [46.5, 65.5, 62.2, 51.5, 90.3],
       [46.8, 65.2, 68.4, 49.3, 90.9],
       [48. , 70.5, 68.9, 50.1, 86.9],
       [41.2, 69.1, 69.7, 51.7, 89.3],
       [49.4, 67.6, 73.5, 52.6, 92.7],
       [49.9, 65.7, 76.8, 51.2, 90.3],
       [53. , 68.9, 79.1, 50.6, 91.3],
       [52.3, 63.7, 80.3, 53.7, 91.2],
       [52.3, 72.9, 81. , 51.3, 85.4],
       [51.4, 69.7, 84. , 53.9, 82. ],
       [55.4, 67.2, 76.4, 54.6, 79.6],
       [58.6, 69.7, 78.9, 56.1, 77.8],
       [62.4, 72.3, 82.6, 53.2, 74.1],
       [63. , 73. , 77. , 50.2, 77.5],
       [62.8, 71.2, 79.3, 50.9, 73.6],
       [61.8, 70.6, 80.5, 56.6, 68.3],
       [62.5, 72.6, 80.6, 61. , 68.6],
       [60. , 72.4, 85.3, 54. , 68.6],
       [61.8, 70.3, 86.7, 49.8, 69.7],
       [64.3, 71.5, 86.1, 53.3, 72.1],
       [64.8, 74.3, 88.7, 57.1, 71.2],
       [65.6, 74.1, 86.2, 55.8, 73. ],
       [69.9, 76.5, 87.9, 47.4, 78.9],
       [73.8, 70.7, 85.7, 47.7, 77.3],
       [76.3, 68.1, 84. , 47.6, 78. ],
       [76. , 63. , 93.6, 40.2, 74.2],
       [80.6, 65.8, 89.1, 44.1, 73.9]])

    mus2 = np.array(
       [[39. , 41. , 50. , 69. , 71.],
       [40.4, 39.1, 46.7, 65.6, 66.8],
       [35.8, 34.4, 44.1, 62.8, 69. ],
       [40.6, 33.1, 45.6, 58.3, 67.7],
       [37.8, 31.4, 46.9, 57.8, 61. ],
       [40.1, 35.8, 49.5, 58. , 58.1],
       [37.3, 37.6, 51.7, 55.1, 55. ],
       [44. , 35. , 50.8, 54.4, 53.1],
       [38.3, 33.6, 50.1, 53.9, 50.4],
       [39.2, 36. , 50.4, 59.1, 51.2],
       [43. , 42.7, 49.2, 66. , 49.6],
       [36.7, 45. , 43.5, 67.9, 53.4],
       [41.2, 46.8, 45.7, 64. , 54. ],
       [40.5, 41.3, 48.2, 61.9, 56.2],
       [35.5, 43.4, 50.2, 61.1, 53.5],
       [39.4, 41.9, 46.4, 57. , 57.9],
       [44.2, 45.2, 51.3, 58.7, 62.7],
       [43.1, 44.7, 49. , 57.8, 63.8],
       [40.1, 48.3, 53.2, 55.4, 65.4],
       [40.5, 51.1, 46.9, 51.8, 67.5],
       [40.4, 50.3, 49.8, 49.8, 64.7],
       [43.5, 50.9, 48.1, 48.8, 68.1],
       [38.5, 50. , 49. , 48.1, 73.9],
       [38.8, 54.6, 51.9, 42.9, 75.2],
       [39. , 54.3, 57. , 41.1, 75.8],
       [40. , 58.7, 57.4, 41.7, 72.4],
       [34.4, 57.6, 58.1, 43.1, 74.4],
       [41.1, 56.3, 61.3, 43.9, 77.3],
       [41.6, 54.7, 64. , 42.6, 75.3],
       [44.2, 57.4, 65.9, 42.2, 76.1],
       [43.6, 53.1, 66.9, 44.8, 76. ],
       [43.6, 60.7, 67.5, 42.8, 71.1],
       [42.9, 58.1, 70. , 44.9, 68.3],
       [46.2, 56. , 63.6, 45.5, 66.4],
       [48.8, 58.1, 65.8, 46.7, 64.8],
       [52. , 60.3, 68.8, 44.4, 61.7],
       [52.5, 60.8, 64.2, 41.8, 64.6],
       [52.3, 59.3, 66.1, 42.4, 61.3],
       [51.5, 58.9, 67.1, 47.2, 56.9],
       [52.1, 60.5, 67.2, 50.8, 57.2],
       [50. , 60.3, 71.1, 45. , 57.1],
       [51.5, 58.6, 72.3, 41.5, 58.1],
       [53.6, 59.6, 71.7, 44.5, 60. ],
       [54. , 61.9, 73.9, 47.6, 59.3],
       [54.7, 61.8, 71.8, 46.5, 60.8],
       [58.2, 63.7, 73.2, 39.5, 65.8],
       [61.5, 58.9, 71.4, 39.7, 64.5],
       [63.6, 56.8, 70. , 39.6, 65. ],
       [63.3, 52.5, 78. , 33.5, 61.9],
       [67.2, 54.8, 74.2, 36.7, 61.5],
       [31.2, 32.8, 40. , 55.2, 56.8],
       [32.3, 31.2, 37.4, 52.5, 53.4],
       [28.6, 27.5, 35.3, 50.3, 55.2],
       [32.5, 26.5, 36.4, 46.6, 54.1],
       [30.3, 25.1, 37.5, 46.2, 48.8],
       [32.1, 28.6, 39.6, 46.4, 46.5],
       [29.8, 30.1, 41.3, 44.1, 44. ],
       [35.2, 28. , 40.6, 43.5, 42.5],
       [30.6, 26.9, 40.1, 43.1, 40.3],
       [31.4, 28.8, 40.3, 47.3, 41. ],
       [34.4, 34.2, 39.4, 52.8, 39.7],
       [29.4, 36. , 34.8, 54.3, 42.8],
       [32.9, 37.4, 36.5, 51.2, 43.2],
       [32.4, 33.1, 38.6, 49.6, 44.9],
       [28.4, 34.8, 40.2, 48.9, 42.8],
       [31.5, 33.5, 37.1, 45.6, 46.3],
       [35.4, 36.2, 41.1, 47. , 50.1],
       [34.5, 35.7, 39.2, 46.2, 51.1],
       [32.1, 38.6, 42.5, 44.3, 52.3],
       [32.4, 40.9, 37.6, 41.4, 54. ],
       [32.3, 40.2, 39.8, 39.8, 51.8],
       [34.8, 40.7, 38.5, 39. , 54.5],
       [30.8, 40. , 39.2, 38.5, 59.1],
       [31. , 43.7, 41.5, 34.3, 60.2],
       [31.2, 43.5, 45.6, 32.8, 60.6],
       [32. , 47. , 46. , 33.4, 57.9],
       [27.5, 46.1, 46.5, 34.4, 59.5],
       [32.9, 45.1, 49. , 35.1, 61.8],
       [33.3, 43.8, 51.2, 34.1, 60.2],
       [35.3, 45.9, 52.8, 33.7, 60.9],
       [34.8, 42.5, 53.5, 35.8, 60.8],
       [34.9, 48.6, 54. , 34.2, 56.9],
       [34.3, 46.5, 56. , 35.9, 54.7],
       [36.9, 44.8, 50.9, 36.4, 53.1],
       [39. , 46.5, 52.6, 37.4, 51.8],
       [41.6, 48.2, 55. , 35.5, 49.4],
       [42. , 48.7, 51.3, 33.4, 51.7],
       [41.9, 47.5, 52.9, 33.9, 49.1],
       [41.2, 47.1, 53.7, 37.7, 45.5],
       [41.6, 48.4, 53.7, 40.7, 45.8],
       [40. , 48.2, 56.9, 36. , 45.7],
       [41.2, 46.9, 57.8, 33.2, 46.5],
       [42.9, 47.7, 57.4, 35.6, 48. ],
       [43.2, 49.5, 59.1, 38.1, 47.4],
       [43.8, 49.4, 57.5, 37.2, 48.6],
       [46.6, 51. , 58.6, 31.6, 52.6],
       [49.2, 47.1, 57.1, 31.8, 51.6],
       [50.8, 45.4, 56. , 31.7, 52. ],
       [50.6, 42. , 62.4, 26.8, 49.5],
       [53.7, 43.9, 59.4, 29.4, 49.2],
       [46.8, 49.2, 60. , 82.8, 85.2],
       [48.5, 46.9, 56. , 78.7, 80.1],
       [42.9, 41.2, 52.9, 75.4, 82.8],
       [48.7, 39.8, 54.7, 69.9, 81.2],
       [45.4, 37.7, 56.3, 69.3, 73.2],
       [48.2, 43. , 59.4, 69.6, 69.7],
       [44.7, 45.2, 62. , 66.1, 66. ],
       [52.7, 42. , 61. , 65.3, 63.7],
       [46. , 40.3, 60.2, 64.7, 60.5],
       [47.1, 43.2, 60.5, 70.9, 61.5],
       [51.6, 51.3, 59.1, 79.2, 59.5],
       [44. , 53.9, 52.2, 81.4, 64.1],
       [49.4, 56.1, 54.8, 76.8, 64.7],
       [48.6, 49.6, 57.8, 74.3, 67.4],
       [42.5, 52.1, 60.2, 73.3, 64.2],
       [47.3, 50.3, 55.7, 68.4, 69.4],
       [53.1, 54.3, 61.6, 70.4, 75.2],
       [51.7, 53.6, 58.8, 69.3, 76.6],
       [48.1, 57.9, 63.8, 66.5, 78.4],
       [48.7, 61.3, 56.3, 62.2, 80.9],
       [48.5, 60.3, 59.7, 59.7, 77.6],
       [52.2, 61.1, 57.7, 58.6, 81.7],
       [46.2, 60. , 58.8, 57.8, 88.7],
       [46.5, 65.5, 62.2, 51.5, 90.3],
       [46.8, 65.2, 68.4, 49.3, 90.9],
       [48. , 70.5, 68.9, 50.1, 86.9],
       [41.2, 69.1, 69.7, 51.7, 89.3],
       [49.4, 67.6, 73.5, 52.6, 92.7],
       [49.9, 65.7, 76.8, 51.2, 90.3],
       [53. , 68.9, 79.1, 50.6, 91.3],
       [52.3, 63.7, 80.3, 53.7, 91.2],
       [52.3, 72.9, 81. , 51.3, 85.4],
       [51.4, 69.7, 84. , 53.9, 82. ],
       [55.4, 67.2, 76.4, 54.6, 79.6],
       [58.6, 69.7, 78.9, 56.1, 77.8],
       [62.4, 72.3, 82.6, 53.2, 74.1],
       [63. , 73. , 77. , 50.2, 77.5],
       [62.8, 71.2, 79.3, 50.9, 73.6],
       [61.8, 70.6, 80.5, 56.6, 68.3],
       [62.5, 72.6, 80.6, 61. , 68.6],
       [60. , 72.4, 85.3, 54. , 68.6],
       [61.8, 70.3, 86.7, 49.8, 69.7],
       [64.3, 71.5, 86.1, 53.3, 72.1],
       [64.8, 74.3, 88.7, 57.1, 71.2],
       [65.6, 74.1, 86.2, 55.8, 73. ],
       [69.9, 76.5, 87.9, 47.4, 78.9],
       [73.8, 70.7, 85.7, 47.7, 77.3],
       [76.3, 68.1, 84. , 47.6, 78. ],
       [76. , 63. , 93.6, 40.2, 74.2],
       [80.6, 65.8, 89.1, 44.1, 73.9]])

    num_rounds = sum(interaction_length) # change num_rounds for testing purpose, but need to make sure that number_sequence

class Subsession(BaseSubsession):
    def creating_session(self):
        # this is run before the start of every round
        round_in_interaction = Constants.round_in_interactions[self.round_number-1]
        interaction_number = Constants.interactions[self.round_number-1]

        for p in self.get_players(): # set interaction number and round number
            p.interaction_number = interaction_number
            p.round_in_interaction = round_in_interaction



class Group(BaseGroup):
    pass


class Player(BasePlayer):
    choice = models.IntegerField(choices=[
        [0, 'A'],
        [1, 'B'],
        [2, 'C'],
        [3, 'D'],
        [4, 'E']]
    )
    noise = models.FloatField()
    ## it may be helpful to define treatment variable, making it easier for data analysis later

    interaction_number = models.PositiveIntegerField()
    round_in_interaction = models.PositiveIntegerField()